#!/bin/sh

#check go

echo -n "Checking go ..."
if [ -x $(which go) ];then
	echo $(go version|awk '{print $3 " " $4}')
else
	echo "not found."
	exit 1
fi
ARG_PREFIX=$1

if [ 'x' != "${ARG_PREFIX}x" ];then
    PREFIX=$(echo $ARG_PREFIX|sed 's/--prefix=//'|sed 's/\//\\\//g')
else
    PREFIX='\/usr\/local\/klver'
fi


PREFIXs=$(echo $PREFIX|sed 's/\\//g')

echo -n "Prefix ... "
echo $PREFIXs

cat 'src/lib/consts/dir.go.in'|sed "s/{PREFIX}/$PREFIX/" > src/lib/consts/dir.go

export GOPATH=$PREFIXs
echo -e "
export GOPATH=${GOPATH}

all: clean build

build:
\tmkdir -p \$(GOPATH)/bin
\tgo get github.com/tonychee7000/mysql
\tgo build klver
\tmv klver \$(GOPATH)/bin
\tmkdir -p \$(GOPATH)/share/log
        
clean:
\trm -rf \$(GOPATH)/pkg
\trm -rf \$(GOPATH)/bin
" > Makefile
